<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBC - Admin Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gold-primary: #c9a227;
            --gold-light: #e8d48b;
            --gold-dark: #8b6914;
            --deep-purple: #0a0612;
            --purple-mid: #120a24;
            --purple-accent: #1e1038;
            --white: #ffffff;
            --white-soft: rgba(255, 255, 255, 0.92);
            --danger: #dc3545;
            --success: #198754;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--deep-purple);
            color: var(--white);
            overflow: hidden;
            min-height: 100vh;
        }

        /* ═══════════════════════════════════════════════════════════════
           LOGIN SCREEN
        ═══════════════════════════════════════════════════════════════ */
        #loginScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background:
                radial-gradient(ellipse 80% 50% at 50% 120%, rgba(201, 162, 39, 0.08) 0%, transparent 50%),
                linear-gradient(180deg, var(--deep-purple) 0%, var(--purple-mid) 100%);
        }

        .login-box {
            background: linear-gradient(165deg, rgba(30, 16, 56, 0.95) 0%, rgba(10, 6, 18, 0.98) 100%);
            padding: 56px 48px;
            border-radius: 4px;
            box-shadow:
                0 1px 0 0 rgba(201, 162, 39, 0.3),
                0 -1px 0 0 rgba(201, 162, 39, 0.1),
                1px 0 0 0 rgba(201, 162, 39, 0.15),
                -1px 0 0 0 rgba(201, 162, 39, 0.15),
                0 25px 50px -12px rgba(0, 0, 0, 0.6);
            position: relative;
            width: 400px;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-primary), transparent);
        }

        .login-box h1 {
            font-family: 'Cinzel', serif;
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 40px;
            color: var(--gold-light);
        }

        .login-box input {
            width: 100%;
            padding: 16px 20px;
            margin: 0 0 20px 0;
            border: 1px solid rgba(201, 162, 39, 0.2);
            border-radius: 2px;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            background: rgba(0, 0, 0, 0.3);
            color: var(--white);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            letter-spacing: 2px;
        }

        .login-box input::placeholder {
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 0.5px;
        }

        .login-box input:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(201, 162, 39, 0.1);
        }

        .login-box button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(180deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            border: none;
            border-radius: 2px;
            color: var(--deep-purple);
            font-size: 13px;
            font-weight: 700;
            font-family: 'Cinzel', serif;
            letter-spacing: 3px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .login-box button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .login-box button:hover::before {
            left: 100%;
        }

        .login-box button:hover {
            background: linear-gradient(180deg, var(--gold-light) 0%, var(--gold-primary) 100%);
        }

        .login-box button:active {
            transform: scale(0.98);
        }

        #loginError {
            color: var(--danger);
            margin-top: 16px;
            font-size: 13px;
            text-align: center;
            display: none;
        }

        /* ═══════════════════════════════════════════════════════════════
           LOGO SCREEN - OPENING ANIMATION
        ═══════════════════════════════════════════════════════════════ */
        #logoScreen {
            display: none;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: var(--deep-purple);
            position: relative;
            overflow: hidden;
            flex-direction: column;
        }

        /* Radial burst background */
        .logo-burst {
            position: absolute;
            width: 200vmax;
            height: 200vmax;
            background: conic-gradient(
                from 0deg,
                transparent 0deg,
                rgba(201, 162, 39, 0.15) 2deg,
                transparent 4deg,
                transparent 20deg,
                rgba(201, 162, 39, 0.1) 22deg,
                transparent 24deg,
                transparent 40deg,
                rgba(201, 162, 39, 0.12) 42deg,
                transparent 44deg,
                transparent 60deg,
                rgba(201, 162, 39, 0.08) 62deg,
                transparent 64deg,
                transparent 80deg,
                rgba(201, 162, 39, 0.15) 82deg,
                transparent 84deg,
                transparent 100deg,
                rgba(201, 162, 39, 0.1) 102deg,
                transparent 104deg,
                transparent 120deg,
                rgba(201, 162, 39, 0.12) 122deg,
                transparent 124deg,
                transparent 140deg,
                rgba(201, 162, 39, 0.08) 142deg,
                transparent 144deg,
                transparent 160deg,
                rgba(201, 162, 39, 0.15) 162deg,
                transparent 164deg,
                transparent 180deg,
                rgba(201, 162, 39, 0.1) 182deg,
                transparent 184deg,
                transparent 200deg,
                rgba(201, 162, 39, 0.12) 202deg,
                transparent 204deg,
                transparent 220deg,
                rgba(201, 162, 39, 0.08) 222deg,
                transparent 224deg,
                transparent 240deg,
                rgba(201, 162, 39, 0.15) 242deg,
                transparent 244deg,
                transparent 260deg,
                rgba(201, 162, 39, 0.1) 262deg,
                transparent 264deg,
                transparent 280deg,
                rgba(201, 162, 39, 0.12) 282deg,
                transparent 284deg,
                transparent 300deg,
                rgba(201, 162, 39, 0.08) 302deg,
                transparent 304deg,
                transparent 320deg,
                rgba(201, 162, 39, 0.15) 322deg,
                transparent 324deg,
                transparent 340deg,
                rgba(201, 162, 39, 0.1) 342deg,
                transparent 344deg,
                transparent 360deg
            );
            animation: burstSpin 60s linear infinite, burstFadeIn 3s ease-out forwards;
            opacity: 0;
        }

        @keyframes burstSpin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes burstFadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Ambient light effect */
        .logo-ambient {
            position: absolute;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse 80% 80% at 50% 50%, rgba(201, 162, 39, 0.15) 0%, transparent 60%);
            animation: ambientPulse 3s ease-in-out infinite;
            opacity: 0;
            animation-delay: 1s;
        }

        @keyframes ambientPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.15); }
        }

        /* Particle field */
        .particle-field {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--gold-light);
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 6px 2px rgba(201, 162, 39, 0.5);
            animation: particleFloat 12s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 0;
                transform: translateY(100vh) scale(0);
            }
            15% {
                opacity: 1;
            }
            85% {
                opacity: 0.6;
            }
            100% {
                opacity: 0;
                transform: translateY(-20vh) scale(1.5);
            }
        }

        /* Main logo rings - more dramatic */
        .logo-ring {
            position: absolute;
            width: 500px;
            height: 500px;
            border: 2px solid rgba(201, 162, 39, 0.4);
            border-radius: 50%;
            animation: ringExpand 4s ease-out forwards;
            box-shadow:
                0 0 30px rgba(201, 162, 39, 0.3),
                inset 0 0 30px rgba(201, 162, 39, 0.1);
        }

        .logo-ring:nth-child(2) {
            width: 600px;
            height: 600px;
            animation-delay: 0.3s;
            border-width: 1px;
        }

        .logo-ring:nth-child(3) {
            width: 700px;
            height: 700px;
            animation-delay: 0.6s;
            border-width: 1px;
            border-style: dashed;
        }

        .logo-ring:nth-child(4) {
            width: 800px;
            height: 800px;
            animation-delay: 0.9s;
            border-width: 1px;
        }

        .logo-ring:nth-child(5) {
            width: 900px;
            height: 900px;
            animation-delay: 1.2s;
            border-width: 1px;
            border-style: dashed;
        }

        @keyframes ringExpand {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            30% {
                opacity: 0.8;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Flare effects */
        .logo-flare {
            position: absolute;
            width: 4px;
            height: 120px;
            background: linear-gradient(180deg, transparent, var(--gold-light), transparent);
            animation: flareSpin 8s linear infinite;
            opacity: 0;
            transform-origin: center 300px;
        }

        .logo-flare:nth-child(1) { animation-delay: 0s; }
        .logo-flare:nth-child(2) { animation-delay: 2s; transform: rotate(90deg); }
        .logo-flare:nth-child(3) { animation-delay: 4s; transform: rotate(180deg); }
        .logo-flare:nth-child(4) { animation-delay: 6s; transform: rotate(270deg); }

        @keyframes flareSpin {
            0% { opacity: 0; transform: rotate(0deg); }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { opacity: 0; transform: rotate(360deg); }
        }

        /* Logo image */
        #logoScreen img {
            max-width: 480px;
            position: relative;
            z-index: 10;
            animation: logoReveal 4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes logoReveal {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(50px);
                filter: blur(20px) brightness(2);
            }
            40% {
                opacity: 1;
                transform: scale(1.1) translateY(0);
                filter: blur(0) brightness(1.5);
            }
            60% {
                transform: scale(0.95) translateY(0);
                filter: blur(0) brightness(1);
            }
            80% {
                transform: scale(1.02) translateY(0);
            }
            100% {
                opacity: 1;
                transform: scale(1);
                filter: blur(0) brightness(1) drop-shadow(0 0 60px rgba(201, 162, 39, 0.5));
            }
        }

        #logoScreen img.idle {
            animation: logoBreathing 4s ease-in-out infinite;
        }

        @keyframes logoBreathing {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 40px rgba(201, 162, 39, 0.4));
            }
            50% {
                transform: scale(1.03);
                filter: drop-shadow(0 0 80px rgba(201, 162, 39, 0.7));
            }
        }

        /* ═══════════════════════════════════════════════════════════════
           GAME SCREEN
        ═══════════════════════════════════════════════════════════════ */
        #gameScreen {
            display: none;
            height: 100vh;
            position: relative;
            background:
                radial-gradient(ellipse 120% 60% at 50% 100%, rgba(201, 162, 39, 0.05) 0%, transparent 50%),
                linear-gradient(180deg, var(--deep-purple) 0%, var(--purple-mid) 50%, var(--deep-purple) 100%);
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 48px;
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid rgba(201, 162, 39, 0.15);
        }

        .walk-away-btn {
            padding: 12px 28px;
            background: transparent;
            border: 1px solid rgba(201, 162, 39, 0.4);
            border-radius: 2px;
            color: var(--gold-primary);
            font-size: 12px;
            font-family: 'Cinzel', serif;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .walk-away-btn:hover {
            background: rgba(201, 162, 39, 0.1);
            border-color: var(--gold-primary);
        }

        .question-number {
            font-family: 'Cinzel', serif;
            font-size: 32px;
            color: var(--gold-light);
            font-weight: 600;
            letter-spacing: 2px;
        }

        .lifelines-top {
            display: flex;
            gap: 16px;
        }

        .lifeline-icon {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            border: 1px solid rgba(201, 162, 39, 0.4);
            background: rgba(201, 162, 39, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 700;
            color: var(--gold-primary);
            font-family: 'Inter', sans-serif;
        }

        .lifeline-icon:hover:not(.used) {
            background: rgba(201, 162, 39, 0.15);
            border-color: var(--gold-primary);
            transform: translateY(-2px);
        }

        .lifeline-icon.used {
            opacity: 0.2;
            cursor: not-allowed;
            border-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
        }

        /* Center Stage */
        .stage-area {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 38vh;
            padding: 20px;
            gap: 80px;
        }

        /* Timer */
        .stage-timer {
            font-family: 'Cinzel', serif;
            font-size: 140px;
            color: var(--gold-light);
            font-weight: 700;
            text-shadow: 0 0 80px rgba(201, 162, 39, 0.3);
            font-variant-numeric: tabular-nums;
            line-height: 1;
        }

        /* Larger timer for rapid mode */
        .stage-timer.rapid-timer {
            font-size: 220px;
            text-shadow: 0 0 100px rgba(201, 162, 39, 0.4);
        }

        .stage-timer.danger {
            color: var(--danger);
            animation: timerUrgent 0.6s ease-in-out infinite;
            text-shadow: 0 0 60px rgba(220, 53, 69, 0.4);
        }

        @keyframes timerUrgent {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.02); }
        }

        .timer-paused {
            opacity: 0.4;
        }

        /* Speaker icon for audio mode */
        .stage-speaker {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid var(--gold-primary);
            background: rgba(201, 162, 39, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: var(--gold-primary);
            filter: drop-shadow(0 0 20px rgba(201, 162, 39, 0.3));
            animation: speakerPulse 1.5s ease-in-out infinite;
        }

        @keyframes speakerPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(201, 162, 39, 0.3);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 40px rgba(201, 162, 39, 0.5);
                transform: scale(1.05);
            }
        }

        /* Image Grid - Vertical 3x1 layout */
        .image-grid {
            display: flex;
            flex-direction: column;
            width: 250px;
            gap: 6px;
        }

        .image-tile {
            width: 250px;
            height: 80px;
            background: linear-gradient(135deg, var(--purple-accent) 0%, var(--purple-mid) 100%);
            border: 1px solid rgba(201, 162, 39, 0.25);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .image-tile::before {
            content: '?';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Cinzel', serif;
            font-size: 28px;
            color: rgba(201, 162, 39, 0.2);
        }

        .image-tile:hover {
            border-color: rgba(201, 162, 39, 0.5);
        }

        .image-tile.revealed {
            background: none;
            border-color: var(--gold-primary);
        }

        .image-tile.revealed::before {
            display: none;
        }

        .image-tile img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .image-tile.revealed img {
            display: block;
            animation: tileReveal 0.4s ease-out;
        }

        @keyframes tileReveal {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Question Section */
        .question-section {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 24px;
            transition: bottom 0.3s ease;
        }

        /* Move question up in rapid mode */
        .rapid-mode .question-section {
            bottom: 15vh;
        }

        .question-hexagon {
            background: linear-gradient(180deg, rgba(30, 16, 56, 0.9) 0%, rgba(18, 10, 36, 0.95) 100%);
            padding: 36px 80px;
            margin: 0 auto 24px;
            max-width: 960px;
            position: relative;
            clip-path: polygon(4% 0%, 96% 0%, 100% 50%, 96% 100%, 4% 100%, 0% 50%);
            border: 1px solid rgba(201, 162, 39, 0.3);
        }

        .question-hexagon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(201, 162, 39, 0.03) 50%, transparent 100%);
            pointer-events: none;
        }

        .question-text {
            font-family: 'Inter', sans-serif;
            font-size: 26px;
            text-align: center;
            color: var(--white-soft);
            font-weight: 500;
            line-height: 1.6;
            letter-spacing: 0.3px;
        }

        /* Options */
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            max-width: 1080px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .option-diamond {
            background: linear-gradient(180deg, rgba(30, 16, 56, 0.85) 0%, rgba(18, 10, 36, 0.9) 100%);
            padding: 20px 40px;
            position: relative;
            clip-path: polygon(2.5% 0%, 97.5% 0%, 100% 50%, 97.5% 100%, 2.5% 100%, 0% 50%);
            border: 1px solid rgba(201, 162, 39, 0.25);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 20px;
            min-height: 68px;
        }

        .option-diamond:hover {
            background: linear-gradient(180deg, rgba(40, 22, 72, 0.9) 0%, rgba(25, 14, 48, 0.95) 100%);
            border-color: rgba(201, 162, 39, 0.5);
        }

        .option-diamond.selected {
            background: linear-gradient(180deg, rgba(201, 162, 39, 0.2) 0%, rgba(139, 105, 20, 0.25) 100%);
            border-color: var(--gold-primary);
            box-shadow: 0 0 40px rgba(201, 162, 39, 0.15);
        }

        .option-diamond.correct {
            background: linear-gradient(180deg, rgba(25, 135, 84, 0.25) 0%, rgba(25, 135, 84, 0.35) 100%);
            border-color: var(--success);
            box-shadow: 0 0 40px rgba(25, 135, 84, 0.2);
            animation: correctPulse 0.6s ease-out;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.01); }
            100% { transform: scale(1); }
        }

        .option-diamond.wrong {
            background: linear-gradient(180deg, rgba(220, 53, 69, 0.2) 0%, rgba(220, 53, 69, 0.3) 100%);
            border-color: var(--danger);
            box-shadow: 0 0 40px rgba(220, 53, 69, 0.15);
            animation: wrongShake 0.4s ease-out;
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .option-diamond.disabled {
            opacity: 0.12;
            cursor: not-allowed;
        }

        .option-letter {
            font-family: 'Cinzel', serif;
            color: var(--gold-primary);
            font-size: 22px;
            font-weight: 600;
            min-width: 36px;
        }

        .option-text {
            font-family: 'Inter', sans-serif;
            color: var(--white-soft);
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        /* ═══════════════════════════════════════════════════════════════
           OVERLAYS
        ═══════════════════════════════════════════════════════════════ */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 3, 10, 0.98);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        #qrOverlay img {
            max-width: 70%;
            max-height: 70%;
            border-radius: 4px;
            box-shadow: 0 0 100px rgba(201, 162, 39, 0.1);
        }

        #phoneOverlay {
            flex-direction: column;
            gap: 40px;
        }

        .phone-icon {
            font-size: 200px;
            color: var(--gold-primary);
            text-shadow: 0 0 80px rgba(201, 162, 39, 0.5);
            animation: phoneRing 0.5s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(201, 162, 39, 0.4));
        }

        @keyframes phoneRing {
            0%, 100% { transform: rotate(-12deg); }
            50% { transform: rotate(12deg); }
        }

        .phone-text {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            color: var(--gold-light);
            letter-spacing: 4px;
            text-transform: uppercase;
            animation: phoneTextPulse 1.5s ease-in-out infinite;
        }

        @keyframes phoneTextPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        #graphOverlay {
            flex-direction: column;
            padding: 60px;
        }

        .graph-title {
            font-family: 'Cinzel', serif;
            font-size: 36px;
            margin-bottom: 48px;
            color: var(--gold-light);
            letter-spacing: 2px;
        }

        .graph-bars {
            display: flex;
            flex-direction: column;
            gap: 24px;
            width: 700px;
        }

        .graph-bar {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .graph-label {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            min-width: 50px;
            color: var(--gold-primary);
        }

        .graph-bar-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            height: 52px;
            border-radius: 2px;
            overflow: hidden;
            border: 1px solid rgba(201, 162, 39, 0.15);
        }

        .graph-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-dark) 0%, var(--gold-primary) 100%);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 20px;
            font-size: 24px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            transition: width 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            color: var(--deep-purple);
        }

        /* FFF Display */
        #fffDisplay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, rgba(30, 16, 56, 0.98) 0%, rgba(10, 6, 18, 0.99) 100%);
            padding: 48px 64px;
            border-radius: 4px;
            z-index: 1000;
            border: 1px solid rgba(201, 162, 39, 0.3);
            box-shadow: 0 0 120px rgba(0, 0, 0, 0.8);
        }

        #fffText {
            font-family: 'Inter', sans-serif;
            font-size: 24px;
            text-align: center;
            color: var(--white-soft);
        }

        /* Phone Timer */
        #phoneTimer {
            display: none;
            position: fixed;
            top: 100px;
            right: 60px;
            background: linear-gradient(180deg, rgba(30, 16, 56, 0.98) 0%, rgba(10, 6, 18, 0.99) 100%);
            padding: 28px 48px;
            border-radius: 4px;
            border: 1px solid rgba(201, 162, 39, 0.3);
            z-index: 999;
        }

        #phoneTimer > div:first-child {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--gold-primary);
            text-align: center;
            margin-bottom: 12px;
        }

        #phoneTimerDisplay {
            font-family: 'Cinzel', serif;
            font-size: 56px;
            color: var(--gold-light);
            font-weight: 700;
            text-align: center;
            font-variant-numeric: tabular-nums;
        }

        #phoneTimerDisplay.danger {
            color: var(--danger);
            animation: timerUrgent 0.6s ease-in-out infinite;
        }

        /* Video Overlay */
        #videoOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.99);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        #videoOverlay video {
            max-width: 90%;
            max-height: 90%;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="loginScreen">
        <div class="login-box">
            <h1>Admin Control</h1>
            <input type="password" id="adminPassword" placeholder="Password">
            <button onclick="adminLogin()">Enter</button>
            <p id="loginError">Invalid credentials</p>
        </div>
    </div>

    <div id="logoScreen">
        <!-- Radial burst background -->
        <div class="logo-burst" style="top: 50%; left: 50%;"></div>

        <!-- Ambient effects -->
        <div class="logo-ambient"></div>
        <div class="particle-field" id="particleField"></div>

        <!-- Expanding rings -->
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>

        <!-- Light flares -->
        <div class="logo-flare"></div>
        <div class="logo-flare"></div>
        <div class="logo-flare"></div>
        <div class="logo-flare"></div>

        <img src="/static/logo.png" alt="KBC Logo">
    </div>

    <div id="gameScreen">
        <!-- Top Bar -->
        <div class="top-bar">
            <button class="walk-away-btn">Walk Away</button>
            <div class="question-number" id="questionNumber">Question 1</div>
            <div class="lifelines-top">
                <div class="lifeline-icon" id="lifeline-50-50" onclick="useLifeline('50-50')" title="50-50">50:50</div>
                <div class="lifeline-icon" id="lifeline-audience-poll" onclick="useLifeline('audience_poll')" title="Audience Poll">AP</div>
                <div class="lifeline-icon" id="lifeline-phone-friend" oncli
ck="useLifeline('phone_friend')" title="Phone a Friend">PF</div>
            </div>
        </div>
        <!-- Center Stage -->
        <div class="stage-area" id="stageArea">
            <!-- Content changes based on question mode -->
        </div>

        <!-- Question Section -->
        <div class="question-section">
            <div class="question-hexagon">
                <div class="question-text" id="questionText">Loading question...</div>
            </div>

            <div class="options-container" id="optionsContainer">
                <!-- Options will be inserted here -->
            </div>
        </div>

        <!-- Overlays -->
        <div class="overlay" id="qrOverlay">
            <img src="/static/qr.png" alt="Scan to Vote">
        </div>

        <div class="overlay" id="phoneOverlay">
            <div class="phone-icon">&#9742;</div>
            <div class="phone-text">Calling...</div>
        </div>

        <div class="overlay" id="graphOverlay">
            <div class="graph-title">Audience Poll Results</div>
            <div class="graph-bars" id="graphBars"></div>
        </div>

        <!-- FFF Display -->
        <div id="fffDisplay">
            <p id="fffText">Waiting for buzz...</p>
        </div>

        <!-- Phone a Friend Timer -->
        <div id="phoneTimer">
            <div>Phone a Friend</div>
            <div id="phoneTimerDisplay">30</div>
        </div>

        <!-- Video Overlay -->
        <div class="overlay" id="videoOverlay">
            <video id="followupVideo" controls></video>
        </div>
    </div>

    <audio id="tickSound" loop>
        <source src="/static/tick.mp3" type="audio/mpeg">
    </audio>
    <audio id="correctSound">
        <source src="/static/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrongSound">
        <source src="/static/wrong.mp3" type="audio/mpeg">
    </audio>
    <audio id="questionAudio"></audio>
    <audio id="openingTheme">
        <source src="/static/opening_theme.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Generate particles for logo screen
        function createParticles() {
            const field = document.getElementById('particleField');
            if (field) {
                field.innerHTML = ''; // Clear particles first to allow restart
                for (let i = 0; i < 80; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = (Math.random() * 8) + 's';
                    particle.style.animationDuration = (8 + Math.random() * 6) + 's';
                    particle.style.width = (2 + Math.random() * 3) + 'px';
                    particle.style.height = particle.style.width;
                    field.appendChild(particle);
                }
            }
        }
        createParticles();

        const socket = io();
        let currentQuestion = 0;
        let selectedOption = null;
        let timerInterval = null;
        let answerRevealed = false;
        let tickTimeout = null;
        let timerPaused = false;
        let phoneTimerInterval = null;
        let phoneTimerActive = false;
        let remainingTime = 15; // Defaulted to 15
        let questionMode = 'rapid';
        let audioPlaying = false;
        let pollQRVisible = false;
        let currentQuestionData = null;
        let logoAnimationComplete = false;
        let gameStarted = false;

        async function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            const response = await fetch('/api/admin/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password})
            });

            if (response.ok) {
                showLogoScreen();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function showLogoScreen() {
            // Hide other screens
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';

            // Show Logo Screen
            document.getElementById('logoScreen').style.display = 'flex';

            // Reset animations
            const logoImg = document.querySelector('#logoScreen img');
            if (logoImg) {
                logoImg.classList.remove('idle');
                // Trigger reflow to restart animation
                void logoImg.offsetWidth;
            }

            // Restart particles
            createParticles();

            // Play opening theme
            const openingTheme = document.getElementById('openingTheme');
            openingTheme.currentTime = 0;
            openingTheme.play();

            // Reset flags
            logoAnimationComplete = false;
            gameStarted = false;

            // After 18 seconds, switch to idle animation and allow S key
            setTimeout(() => {
                logoAnimationComplete = true;
                const logoImg = document.querySelector('#logoScreen img');
                if (logoImg) {
                    logoImg.classList.add('idle');
                }
            }, 18000);
        }

        function startGame() {
            if (!logoAnimationComplete) return;

            document.getElementById('logoScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            gameStarted = true;

            // Start playing from question 0 (or you could persist currentQuestion if desired)
            // Typically restarting means resetting to 0
            currentQuestion = 0;
            loadQuestion(0);
        }

        async function loadQuestion(index) {
            currentQuestion = index;
            selectedOption = null;
            answerRevealed = false;
            audioPlaying = false;

            const response = await fetch(`/api/questions/${index}`);
            if (!response.ok) {
                // END OF GAME - Return to Logo Screen
                showLogoScreen();
                return;
            }
            const question = await response.json();
            currentQuestionData = question;

            questionMode = question.mode || 'rapid';

            document.getElementById('questionNumber').textContent = `Question ${index + 1}`;
            document.getElementById('questionText').textContent = question.question;

            // Setup center stage based on mode
            const stageArea = document.getElementById('stageArea');
            stageArea.innerHTML = '';

            if (questionMode === 'rapid') {
                stageArea.innerHTML = '<div class="stage-timer rapid-timer" id="stageTimer">15</div>';
                document.body.classList.add('rapid-mode');
                startTimer(15);

            } else if (questionMode === 'audio') {
                document.body.classList.remove('rapid-mode');
                stageArea.innerHTML = `
                    <div class="stage-timer" id="stageTimer">15</div>
                    <div class="stage-speaker">&#128266;</div>
                `;
                const audio = document.getElementById('questionAudio');
                audio.src = question.audio;
                audio.load();
                startTimer(15);

            } else if (questionMode === 'image') {
                document.body.classList.remove('rapid-mode');
                const timerDiv = document.createElement('div');
                timerDiv.className = 'stage-timer';
                timerDiv.id = 'stageTimer';
                timerDiv.textContent = '15';

                const grid = document.createElement('div');
                grid.className = 'image-grid';

                // Create 3 tiles: img1 (top), img2 (center), img3 (bottom)
                for (let i = 1; i <= 3; i++) {
                    const tile = document.createElement('div');
                    tile.className = 'image-tile';
                    tile.dataset.position = i;
                    const imgSrc = question[`img${i}`] || question.image;
                    tile.innerHTML = `<img src="${imgSrc}" alt="Mystery Image ${i}">`;
                    grid.appendChild(tile);
                }

                stageArea.appendChild(timerDiv);
                stageArea.appendChild(grid);

                startTimer(15);
                // Reveal all images at once
                document.querySelectorAll('.image-tile').forEach(tile => {
                    tile.classList.add('revealed');
                });

            } else if (questionMode === 'video') {
                // VIDEO MODE: 16:9 Aspect Ratio (approx 445px x 250px)
                document.body.classList.remove('rapid-mode');

                // Injecting HTML with standard YT ratio
                stageArea.innerHTML = `
                    <div class="stage-timer" id="stageTimer">15</div>
                    <div id="questionVideoContainer" style="
                        width: 445px;
                        height: 250px;
                        border: 2px solid #c9a227;
                        background: rgba(201, 162, 39, 0.1);
                        border-radius: 2px;
                        overflow: hidden;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 0 20px rgba(201, 162, 39, 0.3);">
                        <video id="questionVideo" src="${question.video}" style="width: 100%; height: 100%; object-fit: cover;" autoplay></video>
                    </div>
                `;

                // Ensure video loops if needed, or stops at end
                const vid = document.getElementById('questionVideo');
                if(vid) vid.volume = 1.0;
                startTimer(15);
            }

            // Setup options (only for non-rapid questions)
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';

            if (questionMode !== 'rapid') {
                ['A', 'B', 'C', 'D'].forEach(letter => {
                    const div = document.createElement('div');
                    div.className = 'option-diamond';
                    div.id = `option-${letter}`;
                    div.innerHTML = `
                        <div class="option-letter">${letter}:</div>
                        <div class="option-text">${question.options[letter]}</div>
                    `;
                    container.appendChild(div);
                });
            }

            socket.emit('load_question', {question_id: index});
        }

        function startTimer(duration) {
            stopTimer();
            timerPaused = false;
            remainingTime = duration;

            const timerEl = document.getElementById('stageTimer');
            if (timerEl) {
                timerEl.textContent = remainingTime;
                timerEl.classList.remove('danger', 'timer-paused');
            }

            // If video mode, ensure video plays when timer starts
            if (questionMode === 'video') {
                const vid = document.getElementById('questionVideo');
                if(vid) vid.play().catch(e => console.log("Autoplay blocked", e));
            }

            timerInterval = setInterval(() => {
                if (!timerPaused) {
                    remainingTime--;
                    const timerEl = document.getElementById('stageTimer');
                    if (timerEl) {
                        timerEl.textContent = remainingTime;
                        if (remainingTime <= 5) {
                            timerEl.classList.add('danger');
                        }
                    }
                    if (remainingTime <= 0) {
                        stopTimer();
                    }
                }
            }, 1000);

            playTickSound();
        }

        function toggleTimer() {
            timerPaused = !timerPaused;

            const timerEl = document.getElementById('stageTimer');
            if (timerEl) {
                if (timerPaused) {
                    timerEl.classList.add('timer-paused');
                    stopTickSound();
                } else {
                    timerEl.classList.remove('timer-paused');
                    playTickSound();
                }
            }

            /*if (questionMode === 'audio') {
                const audio = document.getElementById('questionAudio');
                if (timerPaused) {
                    audio.pause();
                } else if (audioPlaying) {
                    audio.play();
                }
            }*/

            // Toggle video playback with timer
            if (questionMode === 'video') {
                const vid = document.getElementById('questionVideo');
                if (vid) {
                    if (timerPaused) vid.pause();
                    else vid.play();
                }
            }

            socket.emit(timerPaused ? 'pause_timer' : 'resume_timer');
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            stopTickSound();

            // Pause video when timer stops
            if (questionMode === 'video') {
                const vid = document.getElementById('questionVideo');
                if (vid) vid.pause();
            }
        }

        function playTickSound() {
            const audio = document.getElementById('tickSound');
            audio.play();

            audio.onended = () => {
                if (timerInterval && !timerPaused) {
                    tickTimeout = setTimeout(() => {
                        playTickSound();
                    }, 1000);
                }
            };
        }

        function stopTickSound() {
            if (tickTimeout) {
                clearTimeout(tickTimeout);
                tickTimeout = null;
            }
            const audio = document.getElementById('tickSound');
            audio.pause();
            audio.currentTime = 0;
        }

        function startPhoneTimer() {
            if (!phoneTimerActive) return;

            socket.emit('start_phone_timer');
            document.getElementById('phoneTimer').style.display = 'block';

            let time = 30; // Phone friend stays 30s as per standard
            document.getElementById('phoneTimerDisplay').textContent = time;
            document.getElementById('phoneTimerDisplay').classList.remove('danger');

            phoneTimerInterval = setInterval(() => {
                time--;
                document.getElementById('phoneTimerDisplay').textContent = time;

                if (time <= 5) {
                    document.getElementById('phoneTimerDisplay').classList.add('danger');
                }

                if (time <= 0) {
                    clearInterval(phoneTimerInterval);
                    phoneTimerInterval = null;
                    setTimeout(() => {
                        document.getElementById('phoneTimer').style.display = 'none';
                        phoneTimerActive = false;
                    }, 2000);
                }
            }, 1000);
        }

        document.addEventListener('keydown', (e) => {
            if ((e.key === 's' || e.key === 'S') && !gameStarted && logoAnimationComplete) {
                startGame();
                return;
            }

            if (!gameStarted) return;

            const key = e.key.toUpperCase();

            if (e.key === '1' && e.location === 3) {
                useLifeline('50-50');
            } else if (e.key === '2' && e.location === 3) {
                useLifeline('audience_poll');
            } else if (e.key === '3' && e.location === 3) {
                useLifeline('phone_friend');
            }
            else if (['A', 'B', 'C', 'D'].includes(key) && !selectedOption && !answerRevealed) {
                selectOption(key);
            }
            else if (e.key === 'Enter' && selectedOption && !answerRevealed) {
                revealAnswer();
            }
            else if (e.key === 'f' || e.key === 'F') {
                activateFFF();
            }
            else if (e.key === 'v' || e.key === 'V') {
                playFollowupVideo();
            }
            else if (e.key === 'p' || e.key === 'P') {
                if (questionMode === 'audio') {
                    toggleAudio();
                } else if (pollQRVisible) {
                    endPoll();
                } else {
                    endPoll();
                }
            }
            else if (e.key === 'q' || e.key === 'Q') {
                closeAllOverlays();
            }
            else if (e.key === 'c' || e.key === 'C') {
                continueAfterIncorrect();
            }
            else if (e.key === ' ') {
                e.preventDefault();
                toggleTimer();
            }
            else if (e.key === 'ArrowLeft' && (answerRevealed || questionMode === 'rapid')) {
                prevQuestion();
            }
            else if (e.key === 'ArrowRight' && (answerRevealed || questionMode === 'rapid')) {
                nextQuestion();
            }
            else if (e.key === 'r' || e.key === 'R') {
                resetLifelines();
            }
            else if (e.key === 's' || e.key === 'S') {
                startPhoneTimer();
            }
        });

        function toggleAudio() {
            const audio = document.getElementById('questionAudio');
            if (audioPlaying) {
                audio.pause();
                audioPlaying = false;
            } else {
                audio.play().catch(err => {
                    console.error('Audio playback failed:', err);
                });
                audioPlaying = true;
            }
        }

        function closeAllOverlays() {
            document.getElementById('qrOverlay').style.display = 'none';
            document.getElementById('phoneOverlay').style.display = 'none';
            document.getElementById('graphOverlay').style.display = 'none';
            document.getElementById('videoOverlay').style.display = 'none';

            const video = document.getElementById('followupVideo');
            video.pause();
            video.currentTime = 0;
            video.src = ""; // Clear source to prevent accidental playback
            video.load();   // Force browser to unload the video resource

            pollQRVisible = false;
        }

        function continueAfterIncorrect() {
            socket.emit('activate_fff');
            if (timerPaused) {
                toggleTimer();
            }
        }

        function selectOption(letter) {
            if (answerRevealed) return;

            selectedOption = letter;
            document.querySelectorAll('.option-diamond').forEach(opt => {
                opt.classList.remove('selected');
            });
            const optionEl = document.getElementById(`option-${letter}`);
            if (optionEl) {
                optionEl.classList.add('selected');
            }
            socket.emit('select_answer', {option: letter});
        }

        async function revealAnswer() {
            if (answerRevealed) return;

            stopTimer();
            answerRevealed = true;

            if (questionMode === 'audio') {
                const audio = document.getElementById('questionAudio');
                audio.pause();
            }

            // Stop video on reveal
            if (questionMode === 'video') {
                const vid = document.getElementById('questionVideo');
                if (vid) vid.pause();
            }

            const response = await fetch(`/api/questions/${currentQuestion}`);
            const question = await response.json();
            const correct = question.correct;

            const selectedEl = document.getElementById(`option-${selectedOption}`);
            const correctEl = document.getElementById(`option-${correct}`);

            if (selectedEl && correctEl) {
                if (selectedOption === correct) {
                    selectedEl.classList.add('correct');
                    document.getElementById('correctSound').play();
                } else {
                    selectedEl.classList.add('wrong');
                    correctEl.classList.add('correct');
                    document.getElementById('wrongSound').play();
                }
            }

            socket.emit('reveal_answer', {selected: selectedOption, correct});
        }

        function playFollowupVideo() {
            if (!currentQuestionData || !currentQuestionData.followup) {
                console.log('No follow-up video available for this question');
                return;
            }

            const videoOverlay = document.getElementById('videoOverlay');
            const video = document.getElementById('followupVideo');
            video.src = currentQuestionData.followup;
            video.load();
            videoOverlay.style.display = 'flex';

            video.play().catch(err => {
                console.error('Video playback failed:', err);
            });
        }

        function useLifeline(type) {
            const btn = document.getElementById(`lifeline-${type.replace('_', '-')}`);
            if (!btn || btn.classList.contains('used')) return;

            if (type === 'phone_friend') {
                phoneTimerActive = true;
                document.getElementById('phoneOverlay').style.display = 'flex';
            } else if (type === 'audience_poll') {
                document.getElementById('qrOverlay').style.display = 'flex';
                pollQRVisible = true;
            }

            socket.emit('use_lifeline', {lifeline: type});
        }

        function activateFFF() {
            socket.emit('activate_fff');
            document.getElementById('fffDisplay').style.display = 'block';
            document.getElementById('fffText').textContent = 'Waiting for buzz...';
        }

        function endPoll() {
            socket.emit('end_poll');
            document.getElementById('qrOverlay').style.display = 'none';
            pollQRVisible = false;
        }

        function nextQuestion() {
            closeAllOverlays();
            loadQuestion(currentQuestion + 1);
        }

        function prevQuestion() {
            closeAllOverlays();
            if (currentQuestion > 0) loadQuestion(currentQuestion - 1);
        }

        function resetLifelines() {
            socket.emit('reset_lifelines');
        }

        // Socket listeners
        socket.on('lifeline_used', (data) => {
            const btn = document.getElementById(`lifeline-${data.lifeline.replace('_', '-')}`);
            if (btn) {
                btn.classList.add('used');
            }
        });

        socket.on('lifeline_5050', (data) => {
            data.remove.forEach(letter => {
                const optionEl = document.getElementById(`option-${letter}`);
                if (optionEl) {
                    optionEl.classList.add('disabled');
                }
            });
        });

        socket.on('poll_results', (data) => {
            const container = document.getElementById('graphBars');
            container.innerHTML = '';

            ['A', 'B', 'C', 'D'].forEach(letter => {
                const percent = data.results[letter] || 0;
                container.innerHTML += `
                    <div class="graph-bar">
                        <div class="graph-label">${letter}</div>
                        <div class="graph-bar-container">
                            <div class="graph-bar-fill" style="width: ${percent}%">${percent}%</div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('graphOverlay').style.display = 'flex';
        });

        socket.on('phone_friend_started', () => {
            // Phone friend activated
        });

        socket.on('fff_winner', (data) => {
            document.getElementById('fffText').textContent = `${data.winner} buzzed first!`;
            setTimeout(() => {
                document.getElementById('fffDisplay').style.display = 'none';
            }, 5000);
        });

        socket.on('lifelines_reset', () => {
            document.querySelectorAll('.lifeline-icon').forEach(btn => {
                btn.classList.remove('used');
            });
        });
    </script>
</body>
</html>